{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "../../../components/dataSource.njk" import dataSource %}

<h2 class="govuk-heading-m">
  Comparison of positive and negative entries by wing in the last 28 days
</h2>

{% if not report.hasErrors %}

{{ dataSource(report.dataSource, report.lastUpdated, {"classes": "govuk-!-margin-bottom-6"}) }}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    {{ govukDetails({
      summaryText: "How you can use this chart",
      text: "This chart lets you see the balance of positive to negative entries across the prison and at wing level. Do these splits suggest a fair and consistent application of incentives?",
      id: "guidance-" + graphId,
      classes: "govuk-!-margin-bottom-2 govuk-!-display-none-print",
      attributes: {
        "data-qa": "guidance",
        "data-ga-category": "How you can use this chart > Behaviour entries by wing",
        "data-ga-label": user.activeCaseload.id | default("")
      }
    }) }}

    {% set chartFeedback %}
      {% include "../../../partials/analytics/chartFeedbackForm.njk" %}
    {% endset %}
    {{ govukDetails({
      summaryText: "Is this chart useful?",
      html: chartFeedback,
      id: "chart-feedback-" + graphId,
      classes: "govuk-!-display-none-print",
      open: chartFeedbackForm.hasErrors,
      attributes: {
        "data-qa": "chart-feedback",
        "data-ga-category": "Is this chart useful > Behaviour entries by wing",
        "data-ga-label": user.activeCaseload.id | default("")
      }
    }) }}
  </div>
</div>

<div class="govuk-!-margin-top-8">
  {#
  <a href="?" class="govuk-button govuk-button--secondary govuk-!-margin-right-6">Download chart</a>
  #}

  <div aria-hidden="true" class="app-chart-legend">
    <span class="app-chart-legend__swatch app-chart-colour--a">&nbsp;</span>
    <span class="app-chart-legend__label">Positive</span>
    <span class="app-chart-legend__swatch app-chart-colour--b">&nbsp;</span>
    <span class="app-chart-legend__label">Negative</span>
  </div>
</div>

<table class="app-chart-table app-chart-table--bars" id="table-{{ graphId }}">
  <caption class="govuk-visually-hidden">
    Comparison of positive and negative entries by wing in the last 28 days
  </caption>

  <thead>
    <tr>
      <th scope="col">Location</th>
      <th scope="col">Positive <span class="govuk-visually-hidden">entries</span></th>
      <th scope="col">Negative <span class="govuk-visually-hidden">entries</span></th>
      <th aria-hidden="true" scope="col"></th>
    </tr>
  </thead>

  <tbody>
    {% for row in report.rows %}
      {% set totalEntries = row.entriesPositive + row.entriesNegative %}

      <tr>
        <td>
          <strong>
            {% if row.href %}
              <a href="{{ row.href }}">{{ row.location }}</a>
            {% else %}
              {{ row.location }}
            {% endif %}
          </strong>
          <br />
          {{ totalEntries | thousands }} <span class="govuk-visually-hidden">entries</span>
        </td>
        <td>
          {{ row.entriesPositive | percentageOf(totalEntries) }}
          <br />
          {{ row.entriesPositive | thousands }} <span class="govuk-visually-hidden">entries</span>
        </td>
        <td>
          {{ row.entriesNegative | percentageOf(totalEntries) }}
          <br />
          {{ row.entriesNegative | thousands}} <span class="govuk-visually-hidden">entries</span>
        </td>
        <td aria-hidden="true" class="app-chart-table__percentage-cell">
          <span class="app-chart-table__axis-midpoint"></span>
          <div class="app-chart-table__percentage-cell-bar app-chart-colour--a" data-style-width="{{ row.entriesPositive | percentageOf(totalEntries, false) }}">&nbsp;<br />&nbsp;</div>
          <div class="app-chart-table__percentage-cell-bar app-chart-colour--b" data-style-width="{{ row.entriesNegative | percentageOf(totalEntries, false) }}">&nbsp;<br />&nbsp;</div>
        </td>
      </tr>

      {% if loop.first %}
        <tr aria-hidden="true">
          <td colspan="3"></td>
          <td class="app-chart-table__percentage-cell">
            <span class="app-chart-table__axis-midpoint"></span>
          </td>
        </tr>
      {% endif %}
    {% endfor %}
  </tbody>

  <tfoot aria-hidden="true">
    <tr>
      <td colspan="3"></td>
      <td class="app-chart-table__axis-values">
        <span class="app-chart-table__axis-midpoint"></span>
        <span class="app-chart-table__axis-value app-chart-table__axis-value--min">0</span>
        <span class="app-chart-table__axis-value app-chart-table__axis-value--mid">50</span>
        <span class="app-chart-table__axis-value app-chart-table__axis-value--max">100</span>
      </td>
    </tr>
    <tr>
      <td colspan="3"></td>
      <td>Percentage</td>
    </tr>
  </tfoot>
</table>

{% else %}

  {% include "../no-data-partial.njk" %}

{% endif %}
