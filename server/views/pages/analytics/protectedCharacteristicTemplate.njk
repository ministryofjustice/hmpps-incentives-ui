{% extends "../../partials/analytics/layout.njk" %}

{% from "../../partials/analytics/chartTrends.njk" import chartTrends %}
{% from "../../partials/analytics/chartPopulation.njk" import chartPopulation %}
{% from "../../partials/analytics/chartPrisonersOnLevels.njk" import chartPrisonersOnLevels %}

{% set chartPageId = "protected-characteristics" %}
{% set chartPageTitle = "Protected characteristics" %}
{% set pageTitle = applicationName + " â€“ " + chartPageTitle %}

{% block content %}
  {{ super() }}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      {% include "../../partials/messages.njk" %}

      {% include "../../partials/formErrorSummary.njk" %}

      <h1 class="govuk-heading-xl">
        {{ chartPageTitle }}
      </h1>

    </div>
  </div>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <form id="form-select-characteristic" method="get" action="/analytics/protected-characteristic" novalidate>
        <div class="govuk-form-group">
          <label class="govuk-label" for="characteristic">
            Select a protected characteristic
          </label>
          <select class="govuk-select" id="characteristic" name="characteristic">
              {%- for option in characteristicOptions -%}
                <option value="{{ option.value }}" {% if option.selected %}selected{% endif %}>{{ option.label }}</option>
              {%- endfor %}
          </select>

          <button class="govuk-button govuk-!-margin-left-2" data-module="govuk-button" data-prevent-double-click="true">
            Show results
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="govuk-grid-row">
    <section class="govuk-grid-column-two-thirds govuk-!-margin-bottom-9">

      {% set chartId = "population-by-" + characteristicName %}
      {{ chartPopulation(
        title=ProtectedCharacteristicsChartsContent[chartId].title,
        guidance=ProtectedCharacteristicsChartsContent[chartId].guidance,
        labelColumn=ProtectedCharacteristicsChartsContent[chartId].labelColumn,
        chartId=chartId,
        googleAnalyticsCategory=ProtectedCharacteristicsChartsContent[chartId].googleAnalyticsCategory,
        activeCaseload=user.activeCaseload.id,
        form=forms[chartId],
        csrfToken=csrfToken,
        report=incentiveLevelsByCharacteristic,
        wideLabel=ProtectedCharacteristicsChartsContent[chartId].wideLabel
      ) }}

    </section>
  </div>

  <div class="govuk-grid-row">
    <section class="govuk-grid-column-two-thirds govuk-!-margin-bottom-9">

      {% set chartId = "incentive-levels-by-" + characteristicName %}
      {{ chartPrisonersOnLevels(
        title=ProtectedCharacteristicsChartsContent[chartId].title,
        guidance=ProtectedCharacteristicsChartsContent[chartId].guidance,
        labelColumn=ProtectedCharacteristicsChartsContent[chartId].labelColumn,
        chartId=chartId,
        googleAnalyticsCategory=ProtectedCharacteristicsChartsContent[chartId].googleAnalyticsCategory,
        activeCaseload=user.activeCaseload.id,
        form=forms[chartId],
        csrfToken=csrfToken,
        report=incentiveLevelsByCharacteristic,
        wideLabel=ProtectedCharacteristicsChartsContent[chartId].wideLabel
      ) }}

    </section>
  </div>

  {% if featureFlags.showAnalyticsPcTrends %}
    <div class="govuk-grid-row">
      <section class="govuk-grid-column-two-thirds govuk-!-margin-bottom-9">

        {% set chartId = "trends-incentive-levels-by-" + characteristicName %}
        {{ chartTrends(
          title=ProtectedCharacteristicsChartsContent[chartId].title,
          guidance=ProtectedCharacteristicsChartsContent[chartId].guidance,
          chartId=chartId,
          googleAnalyticsCategory=ProtectedCharacteristicsChartsContent[chartId].googleAnalyticsCategory,
          activeCaseload=user.activeCaseload.id,
          form=forms[chartId],
          csrfToken=csrfToken,
          report=incentiveLevelsTrendsByCharacteristic,
          showTotalPopulation=false
        ) }}

      </section>
    </div>

    <div class="govuk-grid-row">
      <section class="govuk-grid-column-two-thirds govuk-!-margin-bottom-9">

        {% set chartId = "trends-entries-by-" + characteristicName %}

        {% set afterHeaderHtml %}
          <form id="form-select-trendsEntriesGroup" method="get" action="#heading-{{ chartId }}" novalidate>
            <input type="hidden" name="characteristic" value="{{ characteristicName }}">
            <div class="govuk-form-group">
              <label class="govuk-label" for="trendsEntriesGroup">
                {{ groupSelectLabel }}
              </label>
              <select class="govuk-select" id="trendsEntriesGroup" name="trendsEntriesGroup">
                {%- for option in trendsEntriesOptions -%}
                  <option value="{{ option.value }}" {% if option.selected %}selected{% endif %}>{{ option.value }}</option>
                {%- endfor %}
              </select>

              <button class="govuk-button govuk-!-margin-left-2" data-module="govuk-button" data-prevent-double-click="true">
                Show results
              </button>
            </div>
          </form>
        {% endset %}

        {{ chartTrends(
          title=ProtectedCharacteristicsChartsContent[chartId].title,
          guidance=ProtectedCharacteristicsChartsContent[chartId].guidance,
          chartId=chartId,
          googleAnalyticsCategory=ProtectedCharacteristicsChartsContent[chartId].googleAnalyticsCategory,
          activeCaseload=user.activeCaseload.id,
          form=forms[chartId],
          csrfToken=csrfToken,
          report=behaviourEntryTrendsByCharacteristic,
          afterHeaderHtml=afterHeaderHtml
        ) }}

      </section>
    </div>
  {% endif %}

  <div class="govuk-grid-row">
    <section class="govuk-grid-column-two-thirds govuk-!-margin-bottom-9">

      {% set chartId = "entries-by-" + characteristicName %}
      {{ chartPrisonersOnLevels(
        title=ProtectedCharacteristicsChartsContent[chartId].title,
        guidance=ProtectedCharacteristicsChartsContent[chartId].guidance,
        labelColumn=ProtectedCharacteristicsChartsContent[chartId].labelColumn,
        chartId=chartId,
        googleAnalyticsCategory=ProtectedCharacteristicsChartsContent[chartId].googleAnalyticsCategory,
        activeCaseload=user.activeCaseload.id,
        form=forms[chartId],
        csrfToken=csrfToken,
        report=behaviourEntriesByCharacteristic,
        wideLabel=ProtectedCharacteristicsChartsContent[chartId].wideLabel
      ) }}

    </section>
  </div>

  {% include "../../partials/analytics/disclaimer.njk" %}
{% endblock %}
