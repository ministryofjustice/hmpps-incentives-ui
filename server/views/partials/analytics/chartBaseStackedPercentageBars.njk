{% extends "./chartBase.njk" %}

{#
Required variables (in addition to base template):
- labelColumn
#}

{% block chart %}

{% set colourChoices = report.columns | chartPalette %}

<div class="govuk-!-margin-top-8">
  {#
  <a href="?" class="govuk-button govuk-button--secondary govuk-!-margin-right-6">Download chart</a>
  #}

  <div aria-hidden="true" class="app-chart-legend">
    {% for column in report.columns %}
      <span class="app-chart-legend__swatch {{ colourChoices[loop.index0] }}">&nbsp;</span>
      <span class="app-chart-legend__label">{{ column }}</span>
    {% endfor %}
  </div>
</div>

<table class="app-chart-table app-chart-table--bars app-chart-table--bars-with-{{ report.columns.length + 1 }}-columns" id="table-{{ graphId }}">
  <caption class="govuk-visually-hidden">
    {{ chartTitle }}
  </caption>

  <thead>
    <tr>
      <th scope="col">{{ labelColumn }}</th>
      {% for column in report.columns %}
        <th scope="col">
          {% block valueColumn %}
            {{ column }}
          {% endblock %}
        </th>
      {% endfor %}
      <th aria-hidden="true" scope="col"></th>
    </tr>
  </thead>

  <tbody>
    {% for row in report.rows %}
      {% set total = row.values | sum %}

      <tr>
        <td>
          <strong>
            {% if row.href %}
              <a href="{{ row.href }}">{{ row.label }}</a>
            {% else %}
              {{ row.label }}
            {% endif %}
          </strong>
          <br />
          {% block rowTotalValue %}
            {{ total | thousands }}
          {% endblock %}
        </td>
        {% for column in report.columns %}
          <td>
            {{ row.values[loop.index0] | percentageOf(total) }}
            <br />
            {% block rowValue %}
              {{ row.values[loop.index0] | thousands }}
            {% endblock %}
          </td>
        {% endfor %}
        <td aria-hidden="true" class="app-chart-table__percentage-cell">
          <span class="app-chart-table__axis-midpoint"></span>
          {% for column in report.columns %}
            <div class="app-chart-table__percentage-cell-bar {{ colourChoices[loop.index0] }}" data-style-width="{{ row.values[loop.index0] | percentageOf(total, false) }}">&nbsp;<br />&nbsp;</div>
          {% endfor %}
        </td>
      </tr>

      {% if loop.first %}
        <tr aria-hidden="true">
          <td colspan="{{ (report.columns | length) + 1 }}"></td>
          <td class="app-chart-table__percentage-cell">
            <span class="app-chart-table__axis-midpoint"></span>
          </td>
        </tr>
      {% endif %}
    {% endfor %}
  </tbody>

  <tfoot aria-hidden="true">
    <tr>
      <td colspan="{{ (report.columns | length) + 1 }}"></td>
      <td class="app-chart-table__axis-values">
        <span class="app-chart-table__axis-midpoint"></span>
        <span class="app-chart-table__axis-value app-chart-table__axis-value--min">0</span>
        <span class="app-chart-table__axis-value app-chart-table__axis-value--mid">50</span>
        <span class="app-chart-table__axis-value app-chart-table__axis-value--max">100</span>
      </td>
    </tr>
    <tr>
      <td colspan="{{ (report.columns | length) + 1 }}"></td>
      <td>Percentage</td>
    </tr>
  </tfoot>
</table>

{% endblock chart %}
