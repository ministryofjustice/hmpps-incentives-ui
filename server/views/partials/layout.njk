{% extends "govuk/template.njk" %}

{% block head %}
  {# Google Analytics: Universal Analytics (UA) #}
  {% if googleAnalyticsUaId %}
    <!-- Google Analytics -->
    <script nonce="{{ cspNonce }}">
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', '{{ googleAnalyticsUaId }}', 'auto');
      {# GA custom dimension 1 is "Active Case Load" -#}
      {% if user.activeCaseload.id -%}
        ga('set', 'dimension1', '{{ user.activeCaseload.id }}');
      {%- endif %}
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
  {% endif %}

  {# Google Analytics: Google Analytics 4 (GA4) #}
  {% if googleAnalyticsGa4Id %}
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ googleAnalyticsGa4Id }}"></script>
    <script nonce="{{ cspNonce }}">
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', '{{ googleAnalyticsGa4Id }}', {
        active_case_load: '{{ user.activeCaseload.id | default('') }}',
      });
    </script>
  {% endif %}

  <link href="/assets/stylesheets/application.css?{{ version }}" rel="stylesheet" />
  <script src="/assets/js/jquery.min.js"></script>

{% endblock %}

{% block pageTitle %}{{pageTitle | default(applicationName)}}{% endblock %}

{% block header %}
  {% include "./header.njk" %}
  {% include "./locationBar.njk" %}
  {% include "./feedbackBanner.njk" %}
  {% include "./breadcrumbs.njk" %}
{% endblock %}

{% block bodyStart %}
{% endblock %}

{% block bodyEnd %}
  {# Run JavaScript at end of the
  <body>, to avoid blocking the initial render. #}
  <script src="/assets/govuk/all.js"></script>
  <script src="/assets/moj/all.js"></script>
  <script src="/assets/application.js"></script>
{% endblock %}

{% block footer %}
  {% from "govuk/components/footer/macro.njk" import govukFooter %}

  {{ govukFooter({
    meta: {
      items: [
        {
          href: supportUrl + "/feedback-and-support",
          text: "Get help"
        },
        {
          href: dpsHome + "/content/terms-conditions",
          text: "Terms and conditions"
        }
      ]
    }
  }) }}
{% endblock %}
